# Лабораторная работа 4: Memory Manager

В работе реализован универсальный менеджер памяти на основе использования подходов Fixed-size Memory Allocation (FSA) и Coalesce Allocation с Free-List. FSA используется для выделения блоков размером 16, 32, 64, 128, 256 и 512 байт, Coalesce Allocation используется для выделения блоков размерами 512 байт - 10 Мб, все запросы блоков размером больше 10 Мб передаются непосредственно ОС.<br /><br />
Для реализации менеджера реализованы два вспомогательных класса - FSAllocator и CoalesceAllocator.<br /><br />
FSAllocator позволяет задавать в своем конструкторе размер одного блока и количество блоков в странице. Для реализации FreeList аллокатор инициализирует новые блоки индексом следующего блока (1 блок инициализируется каждый вызов allocate()). Голова списка находится перед блоками данных и представляет собой структуру Page, содержащую также информацию о количестве инициализированных блоков, указатель на следующую страницу и указатель на начало блоков данных. Индекс -1 означает отсутствие следующего элемента. В отладочной версии на страницу резервируется в 3 раза больше памяти чтобы разместить около каждого блока 8-байтовые флаги для отслеживания повреждения данных. (0xAAAAAAAAAAAAAAAA в начале и 0x5555555555555555 в конце). Целостность данных блока проверяется при освобождении его вызовом free.<br /><br />
CoalesceAllocator позволяет задавать в своем конструкторе размер страницы. Для реализации FreeList аллокатор поддерживает перед началом каждого блока (вне зависимости от занятости) его размер. Также в свободных блоках размещена структура FreeBlock, содержащая указатели на предыдущий и последующий свободные блоки. Голова списка находится перед блоками данных и представляет собой структуру Page, содержащую также указатель на следующую страницу и указатель на начало блоков данных.  В отладочной версии аллокатор размещает перед началом и после конца каждого блока аналогичные FSA 8-битные флаги, работающие по такому же принципу, как и в FSA.<br /><br />
Класс MemoryAllocator реализован в соответствии с заданием и использует другие аллокаторы с размером страниц 10 Мб. Он поддерживает следующие операции:<br />
```
MemoryAllocator();
```
Создает неинициализированный аллокатор.
```
virtual ~MemoryAllocator();
```
Деструктор.
```
virtual void init();
```
Выполняет инициализацию аллокатора, запрашивая необходимые страницы памяти у ОС.
```
virtual void destroy();
```
Выполняет деинициализацию аллокатора, возвращая всю
запрошенную память ОС.
```
virtual void* alloc(size_t size);
```
Выделяет блок памяти размером size байт, выровненный по границе
в 8 байт.
```
virtual void free(void *p);
```
Освобождает занимаемую память, на которую указывает указатель p.
```
virtual void dumpStat() const;
```
Отладочный метод. Выводит в стандартный поток вывода статистику по аллокаторам: количество занятых и свободных блоков, список блоков запрошенных у ОС и их размеры.
```
virtual void dumpBlocks() const;
```
Отладочный метод. Выводит в стандартный поток вывода список всех занятых блоков: их аллокаторы, страницы, адреса и размеры.
